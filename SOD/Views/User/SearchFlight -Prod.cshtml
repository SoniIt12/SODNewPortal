@model IEnumerable<SOD.Model.TravelRequestModels>
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="http://www.spicejet.com/images/favicon9.ico" />
    <title>Sod | Search Flight</title>
    <link href="../asset/css/bootstrap.min.css" rel="stylesheet" />
    <script src="../js/jquery-2.1.1.min.js"></script>
    <script src="../asset/js/bootstrap.min.js"></script>
    <script src="../New_Calender/src/calender_jquery.daterange.js"></script>
    <link href="../New_Calender/calender.css" rel="stylesheet" />
    <script src="../Dropdownmenu/jquery-1.9.1.js"></script>
    <script src="../Dropdownmenu/jquery-ui.js"></script>    
    <link href="../Dropdownmenu/jquery-ui.css" rel="stylesheet" />
    <link href="../css/SODstyle.css" rel="stylesheet" />
    <script src="../js/jsvalidation.js"></script>
    <link href="../3D_button/3dbtn.css" rel="stylesheet" />
    <link href="../css/radiobtn.css" rel="stylesheet" />

    <style type="text/css">
        .ui-menu-item {
            width: 25% !important;
            float: left;
        }
    </style>

    <script type="text/javascript">
    $(document).ready(function () {
        var ddlbookingTypes=1;
        hideshowFlightDiv('0');
        Sod_NonSodChange();
        $('#dvMsg').hide();
        var counter = 2;
        $("#addButtonnew").click(function () {
            if (counter > 5) {
                alert("Only 5 Multicity Sectors are allowed.");
                return false;
            }
            var newTextBoxDiv = $(document.createElement('div'))
                 .attr("id", 'TextBoxDiv' + counter);
            newTextBoxDiv.after().html('<div style="margin-top:20px; border:solid 1px #b33; padding:20px;border-radius:3px;"><table class="dynamiccontroltbl" style="width:100%;" cellpadding="4" cellspacing="4"  ><tr><td ><label style="font-size:16px; color:#b33;">City #' + counter + ' : </label></td><td></td><td></td></tr>   <tr><td><input placeholder="Origin" style="width:90%; padding:10px; font-size:15px; height:35px;border-radius:3px;border: 0px;" type="text" name="textbox' + counter +
                 '" id="textboxorigin' + counter + '" value="" ></td> <td>   <input  placeholder="Destination" style="width:90%;padding:10px; font-size:15px; height:35px;border-radius:3px;border: 0px;" type="text" name="textbox' + counter +
                 '" id="textboxdest' + counter + '" value="" ></td>   <td><input placeholder="Date of Travel" style="width:90%; padding:10px; font-size:15px; height:35px;border-radius:3px;border: 0px;" type="text"  name="textbox' + counter +
                 '" id="txttraveldt' + counter + '" value="" ></td></tr> </table></div>');
            newTextBoxDiv.appendTo("#TextBoxesGroup");
            //for multicity bind
            GetOriginStation('textboxorigin' + counter, 'textboxdest' + counter);

            $(function () {
                $('#txttraveldt' + counter).datepicker({
                    numberOfMonths: 2,
                    minDate: new Date(),
                    maxDate: new Date(2018, 11, 31),
                    dateFormat: "dd/mm/yy"
                });
            });
            counter++;
        });
        $("#removeButton").click(function () {
            if (counter == 1) {
                alert("No more textbox to remove");
                return false;
            }
            counter--;
            $("#TextBoxDiv" + counter).remove();
        });
        $("#getButtonValue").click(function () {
            var msg = '';
            for (i = 1; i < counter; i++) {
                msg += "\n Textbox #" + i + " : " + $('#textbox' + i).val();
            }
            alert(msg);
        });

        if (@Session["usertype"] == 1)
        {
            $("#lnkapprover").show();
            $("#lnkbulkapprover").show();
            $("#lnkoatapprover").show();
            $("#lnkbbklist").show();
            if(@Session["cxo"]==1)
                $("#lnkapprover").attr("href", "../cxoapp/GetBookingList?dep=@ViewBag.DeptId &deg=@ViewBag.DesigId")
            else
                $("#lnkapprover").attr("href", "../SodApprover/GetBookingList?dep=@ViewBag.DeptId &deg=@ViewBag.DesigId")

            $("#lnkbulkapprover").attr("href", "../bulk/bulkappList")
            $("#lnkoatapprover").attr("href", "../OatApprover/GetOatApproverList?dep=@ViewBag.DeptId &deg=@ViewBag.DesigId")
        }
        else
        {
            $("#lnkapprover").hide();
            $("#lnkbulkapprover").hide();
            $("#lnkoatapprover").hide();
            $("#lnkbbklist").hide();
        }

        //Get User Travel History List
        $("#lnktravelHistory").click(function(){
            $("#lnktravelHistory").attr("href", "../SodApprover/ViewTravelList");
        });

        //Get OAT Travel History List
        $("#lnkoatHistory").click(function(){
            $("#lnkoatHistory").attr("href", "../OAT/oatTravelHistory");
        });

        //Get Bulk Booking List
        $("#lnkbbklist").click(function(){
            $("#lnkbbklist").attr("href", "../bulk/viewbbkList");
        });

        //Check Bulk Rights
        if(@ViewBag.blkRight == 0)
        {
            var row = document.getElementById("trsodtype");
            //row.deleteCell(2);
            //row.deleteCell(2);
            //row.deleteCell(4);
        }
        else
        {
            $("#lnkbbklist").show();
        }

        //Get User Travel History List
        $("#lnktravelHistory").click(function(){
            $("#lnktravelHistory").attr("href", "../SodApprover/ViewTravelList");
        });
    });

    //Hide show div
    function hideshowFlightDiv(flag)
    {
        $('.loader').hide();
        if(flag=='0')
        {
            $('#dvMainRowContainer').hide();
            $('#lnkContinue').hide();
            $('#lnkRefresh').hide();
            $('#imgFlyteType').hide();
        }
        else
        {
            $('#dvMainRowContainer').show();
            $('#lnkContinue').show();
            $('#lnkRefresh').show();
            $('#imgFlyteType').show();
        }
    }

    //Sod/Non-Sod change function
    function Sod_NonSodChange()
    {
        if( $('input[name="radio"]:checked').val()=='sod')
        {
            $("#ddpassenger")[0].selectedIndex = 0;
            $("#ddpassenger_roundtrip")[0].selectedIndex = 0;
            $("#ddpassenger_multicity")[0].selectedIndex = 0;

            $("#ddpassenger").prop( "disabled", true );
            $("#ddpassenger_roundtrip").prop( "disabled", true );
            $("#ddpassenger_multicity").prop( "disabled", true );
            ddlbookingTypes=1;
        }
        else
        {
            $("#ddpassenger").prop( "disabled", false );
            $("#ddpassenger_roundtrip").prop( "disabled", false );
            $("#ddpassenger_multicity").prop( "disabled", false );
            ddlbookingTypes=2;
        }
    }

    //Bulk booking
    function BulkBookingChange(){
        var url='../bulk/blkbooking';
        var win = window.open(url, '_blank');
        win.focus();
    }

     //DownTime
    function downtime()
    {
        alert('SOD Downtime: New updates are going on... ... ... ...\nPlease try after some times. \nSorry for your inconvenience.');
        //$("#OnewaySubmit").hide(); $("#btnRoundTrip").hide(); $("#btnMulCity").hide();
    }
    
    //OAT booking
    function OALBookingChange(){
        var url='../oat/oatbooking';
        var win = window.open(url, '_blank');
        win.focus();
    }
</script>

    <script>
    var travelRequestTypeIdG="";
    $(function () {
        $("#txtddate").datepicker({
            numberOfMonths: 2,
            minDate: new Date(),
            maxDate: new Date(2018, 11, 31),
            dateFormat: "dd/mm/yy",
        });
    });
   
    $(function () {
            $("#txttraveldt1").datepicker({
                numberOfMonths: 2,
                minDate: new Date(),
                maxDate: new Date(2018, 11, 31),
                dateFormat: "dd/mm/yy",
            });
      });

      $(function () {
            var fromDate = $("#rarrivaldt").datepicker({
                numberOfMonths: 2,
                dateFormat: "dd/mm/yy",
                minDate: new Date(),
                maxDate: new Date('12/31/2018'),
                onSelect: function (selectedDate) {
                var instance = $(this).data("datepicker");
                var date = $.datepicker.parseDate(instance.settings.dateFormat || $.datepicker._defaults.dateFormat, selectedDate, instance.settings);
                date.setDate(date.getDate());
                toDate.datepicker("option", "minDate", date);
                },
                onClose: function (event, ui) { $("#rdepartdt").focus(); }
            });

            var toDate = $("#rdepartdt").datepicker({
                numberOfMonths: 2,
                maxDate: new Date('12/31/2018'),
                dateFormat: "dd/mm/yy"
            });
        });
     
  
        //One way submit data
        function OnewaySubmit() {
            //validations
            if($("#txt-pickup").val()==""){
                alert('Please select origin place');
                $("#txt-pickup").focus();
                return false;
            }
            else if($("#txt-destination").val()==""){
                alert('Please select destination place');
                $("#txt-destination").focus();
                return false;
            }
            else if($("#txtddate").val()==""){
                alert('Please select travel date.');
                $("#txtddate").focus();
                return false;
            }
            var sodRequestList = new Array();
            var obj = new Object();
            obj.TravelRequestTypeId = "1";
            travelRequestTypeIdG="1";
            obj.OriginPlace = document.getElementById("txt-pickup").value.split("-")[1];
            obj.DestinationPlace = document.getElementById("txt-destination").value.split("-")[1];
            obj.TravelDate = document.getElementById("txtddate").value;
            obj.Passengers = $('#ddpassenger').val();
            obj.SodBookingType=ddlbookingTypes;
            obj.BookingFor= $('#ddlbookingFor').val();
            sodRequestList.push(obj);
            //debugger;
            var sodRequestsList = JSON.stringify({ sodRequestsList: sodRequestList });
            
            $.ajax({
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                type: 'POST',
                url: '../user/SodRequestSubmit',
                data: sodRequestsList,
                beforeSend: function(){
                    $('.loader').show()
                },
                complete: function(){
                    $('.loader').hide();
                },
                success: function (data) {
                    TravelResponse(data);
                    $("#ddlbookingFor").prop("disabled", true);
                     
                },
                error: function (xhr, status, exception) {
                    $("#spanfail").html("Searching error");
                    $('.loader').hide();
                }
            });
            
        }
 
        //Round Trip submit data
        function RoundTripSubmit() {
            //validations
            if($("#txt-pickup-rt").val()==""){
                alert('Please select origin place');
                $("#txt-pickup-rt").focus();
                return false;
            }
            else if($("#txt-destination-rt").val()==""){
                alert('Please select destination place');
                $("#txt-destination-rt").focus();
                return false;
            }
            else if($("#rarrivaldt").val()==""){
                alert('Please select travel date.');
                $("#rarrivaldt").focus();
                return false;
            }
            else if($("#rdepartdt").val()==""){
                alert('Please select return date.');
                $("#rdepartdt").focus();
                return false;
            }
          

            var sodRequestList = new Array();
            var obj = new Object();
            obj.TravelRequestTypeId = "2";
            travelRequestTypeIdG="2";
            obj.OriginPlace = document.getElementById("txt-pickup-rt").value.split("-")[1];
            obj.DestinationPlace = document.getElementById("txt-destination-rt").value.split("-")[1];
            obj.TravelDate = document.getElementById("rarrivaldt").value;
            obj.ReturnDate = document.getElementById("rdepartdt").value;
            obj.Passengers = $('#ddpassenger_roundtrip').val();
            obj.SodBookingType=ddlbookingTypes;// $('#ddlbookingType').val();
            obj.BookingFor= $('#ddlbookingFor_roundtrip').val();
            sodRequestList.push(obj);
            var sodRequestsList = JSON.stringify({ sodRequestsList: sodRequestList });

            $.ajax({
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                type: 'POST',
                url: '../user/SodRequestSubmit',
                data: sodRequestsList,
                beforeSend: function(){
                    $('.loader').show()
                },
                complete: function(){
                    $('.loader').hide();
                },
                success: function (data) {
                    TravelResponse(data);
                    $("#ddlbookingFor_roundtrip").prop("disabled", true );
                },
                error: function () {
                    $("#spanfail").html("Searching error..");
                }
            });
            
        }

        //Multicity Submit
        function MulticitySubmit() {
            var sodRequestList = new Array();
            var counter = 0;
            var passenger = 0;
            var flag=0;
            $('.dynamiccontroltbl').each(function () {
                var obj = new Object();
                counter++;
                //------------Validations---------------------------
                if($(this).find("input")[0].value==""){
                    alert('Please select origin place');
                    $(this).find("input")[0].focus();
                    flag=1;
                    return false;
                }
                else if($(this).find("input")[1].value==""){
                    alert('Please select destination place');
                    $(this).find("input")[1].focus();
                    flag=1;
                    return false;
                }
                else if($(this).find("input")[2].value==""){
                    alert('Please select travel date.');
                    $(this).find("input")[2].focus();
                    flag=1;
                    return false;
                }
                //----------------------End of Validations-------
                if(flag==0)
                {
                    obj.TravelRequestTypeId = "3";
                    travelRequestTypeIdG="3";
                    obj.OriginPlace = $(this).find("input")[0].value.split("-")[1];
                    obj.DestinationPlace = $(this).find("input")[1].value.split("-")[1];
                    obj.TravelDate = $(this).find("input")[2].value;
                    obj.Passengers = $('#ddpassenger_multicity').val();
                    obj.SodBookingType=ddlbookingTypes; 
                    obj.BookingFor=$('#ddlbookingFor_multicity').val();
                    sodRequestList.push(obj);
                }
            });

            if( flag==0)
            {
                var sodRequestsList = JSON.stringify({ sodRequestsList: sodRequestList });
                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    type: 'POST',
                    url: '../user/SodRequestSubmit',
                    data: sodRequestsList,
                    beforeSend: function(){
                        $('.loader').show()
                    },
                    complete: function(){
                        $('.loader').hide();
                    },
                    success: function (data) {
                        TravelResponseMulticity(data);
                        $("#ddlbookingFor_multicity").prop("disabled", true );
                    },
                    error: function () {
                        $("#spanfail").html("Searching error..");
                    }
                });
            }
        }

        //Get Origin station Name
        function GetOriginStation(objid,objdest) {
            $.ajax({
                type: "POST",
                url: "../User/GetOriginStation",
                data: {},
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                beforeSend: function(){
                    $('.loader').show();
                },
                complete: function(){
                    $('.loader').hide();
                },
                success: function (data) {
                    ctyData = JSON.parse(data);
                    var datalist = [];
                    for (var prop in ctyData) {
                        datalist.push(ctyData[prop]);
                    }
                    //datalist.sort(SortByName1);
                    $("#" + objid).autocomplete({
                        source: datalist,
                        minLength: 0,
                        autoFocus: true,
                        select: function (event, ui) {
                            destinationlist = [];
                            $("#" + objdest).val('');
                            //var arrcode = ui.item.value.substr(ui.item.value.indexOf('(') + 1, 3);
                            var arrcode = ui.item.value.split('-')[1];
                            GetDestStation(arrcode, objdest)
                            $("#" + objdest).focus();
                        }
                    }).focus(function () {
                        //$(this).trigger('keydown.autocomplete');
                        $(this).data("autocomplete").search($(this).val());
                    });
                },
                failure: function (response) {
                    alert(response);
                },
                error: function (xhr, status, exception) {
                    var err = eval("(" + xhr.responseText + ")");
                    alert(err.Message);
                }
            });
        }
        //Get Destination Station Name
        var destinationlist = [];
        function GetDestStation(objDest, objid) {
            var JSONObject = { "objArr": objDest };
            var jsonData = JSON.stringify(JSONObject)
            $.ajax({
                type: "POST",
                url: "../User/GetArrivalStation",
                data: jsonData,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                beforeSend: function(){
                    $('.loader').show();
                },
                complete: function(){
                    $('.loader').hide();
                },
                success: function (data) {
                    jdestination = JSON.parse(data);
                    for (var prop in jdestination) {
                        destinationlist.push(jdestination[prop]);
                    }
                    //destinationlist.sort(SortByName1);
                    $("#" + objid).autocomplete({
                        source: destinationlist,
                        minLength: 0,
                        //autoFocus: true,
                        select: function (event, ui) {
                            //debugger;
                            $("#txtddate").focus();
                            if($("#rarrivaldt")!='undefined' || $("#rarrivaldt")==null)
                                $("#rarrivaldt").focus();
                        }
                    }).focus(function () {
                        $(this).data("autocomplete").search($(this).val());
                    });
                    $("#" + objid).focus();
                },
                failure: function (response) {
                    alert(response);
                },
                error: function (xhr, status, exception) {
                    var err = eval("(" + xhr.responseText + ")");
                    alert(err.Message);
                }
            });
        }
        //One way
        GetOriginStation('txt-pickup', 'txt-destination');
        //Round Trip
        GetOriginStation('txt-pickup-rt', 'txt-destination-rt');
        //MultiCity
        GetOriginStation('textboxorigin1', 'textboxdest1');
    </script>

    <script>
        //Response for Oneway and Round Trip
        //Bind flight div
        function TravelResponse(response) {
            var xmlDoc = $.parseXML(response);
            var xml = $(xmlDoc);
            var min = parseInt(xml.find("PageCount").eq(0).find("Min").text());
            var max = parseInt(xml.find("PageCount").eq(0).find("Max").text());
            var flights = xml.find("flights");
            var table = $("#dvgo div").eq(0).clone(true);
            if(flights.length>0)
                $("#dvgo div").remove();
            //Return Flights
            var rflights = xml.find("Rflights");
            var rtable ="";
            if(rflights.length>0)
            {
                $("#dvreturn div").show();
                rtable = $("#dvreturn div").eq(0).clone(true);
                $("#dvreturn div").remove();
            }
            else
            {
                $("#dvreturn div").hide();
            }

            //Flight details
            flights.each(function () {
                var flight = $(this);
                var ftype=flight.find("FlightTypes").text()
                $(".depflightNo", table).html(flight.find("FlightNo").text());
                $("#chkradiodept", table).val(flight.find("FlightNo").text());
                $(".arrDate", table).html(flight.find("ShortDate").text());
                $(".depcity", table).html(flight.find("From").text());
                $(".arrcity", table).html(flight.find("To").text());
                $(".deptime", table).html(flight.find("STD").text().substr(11));
                $(".arrtime", table).html(flight.find("STA").text().substr(11));
                $(".deptimeduration", table).html(flight.find("TimeDuration").text());
                $(".planeName", table).html(flight.find("FlightName").text());
                $(".depflighttype", table).html(flight.find("FlightTypes").text()); 

                if(ftype==1){
                    $(".ftype", table).attr("src","../img/Red_img.png");
                    $(".wrapper .tooltip", table).html(flight.find("FlightInfos").text());
                }
                else if(ftype==2){
                    $(".ftype", table).attr("src","../img/Orange_img.png");
                    $(".wrapper .tooltip", table).html(flight.find("FlightInfos").text());
                }
                else if(ftype==3){
                    $(".ftype", table).attr("src","../img/Blue_img.png");
                    $(".wrapper .tooltip", table).html(flight.find("FlightInfos").text());
                }

                $("#dvgo").append(table);
                table = $("#dvgo div").eq(0).clone(true);
            });

            //Return Flights details
            rflights.each(function () {
                var rflight = $(this);
                var ftypes=rflight.find("FlightTypes").text()
                $(".retFlightNo", rtable).html(rflight.find("FlightNo").text());
                $("#chkradioreturn", table).val(rflight.find("FlightNo").text());
                $(".ret_arrDate", rtable).html(rflight.find("ShortDate").text());
                $(".retCity", rtable).html(rflight.find("From").text());
                $(".ret_arrcity", rtable).html(rflight.find("To").text());
                $(".rettime", rtable).html(rflight.find("STD").text().substr(11));
                $(".ret_arrtime", rtable).html(rflight.find("STA").text().substr(11));
                $(".retDuration", rtable).html(rflight.find("TimeDuration").text());
                $(".planeName", rtable).html(rflight.find("FlightName").text());
                $(".retflighttype", rtable).html(rflight.find("FlightTypes").text());

                $("#dvreturn").append(rtable);
                if(ftypes==1)
                {
                    $(".ftype", rtable).attr("src","../img/Red_img.png");
                    $(".wrapper .tooltip", rtable).html(rflight.find("FlightInfos").text());
                }
                else if(ftypes==2){
                    $(".ftype", rtable).attr("src","../img/Orange_img.png");
                    $(".wrapper .tooltip", rtable).html(rflight.find("FlightInfos").text());
                }
                else if(ftypes==3){
                    $(".ftype", rtable).attr("src","../img/Blue_img.png");
                    $(".wrapper .tooltip", rtable).html(rflight.find("FlightInfos").text());
                }
                rtable = $("#dvreturn div").eq(0).clone(true);
            });

            if(flights.length>0){
                hideshowFlightDiv('1');
                $('#dvMsg').hide();
            }
            else
            {
                hideshowFlightDiv('0');
                $('#dvMsg').html('Sorry : Flight not available.');
                $('#dvMsg').show();
            }
            //alert('hi');
            //var targetDiv = $('#dvMainRowContainer');
            //alert(targetDiv);
            $('html, body').animate({
                scrollTop: $("#dvMainRowContainer").offset().top
            }, 2000, 'easeOutExpo');

        }
        //Travel Response Multicity
        function TravelResponseMulticity(response) {
            debugger;
            $("#dvreturn div").remove();
            var flights="";
            var xmlDoc = $.parseXML(response);
            var xml = $(xmlDoc);
            var min = parseInt(xml.find("PageCount").eq(0).find("Min").text());
            var max = parseInt(xml.find("PageCount").eq(0).find("Max").text());
            var dtsector = parseInt(xml.find("dtsector").eq(0).find("SectorCount").text());
            var tablesector = $("#dvMainRowContainer div").eq(0).clone(true);
            //if(xml.parents.length>0)
            $("#dvMainRowContainer div").remove();

            for (var i = 1; i <= dtsector; i++) {
                flights = xml.find("flights" + i);
                var tablinner = $("#dvInnerContainer div", tablesector).eq(0).clone(true);
                if(flights.length>0)
                    $("#dvInnerContainer div", tablesector).remove();
                //Flight details
                flights.each(function () {
                    var flight = $(this);
                    var ftypes=flight.find("FlightTypes").text()
                    $(".depflightNo", tablinner).html(flight.find("FlightNo").text());
                    $("#chkradiodept", tablinner).val(flight.find("FlightNo").text());
                    $("#chkradiodept", tablinner).attr('name', i);
                    $(".arrDate", tablinner).html(flight.find("ShortDate").text());
                    $(".depcity", tablinner).html(flight.find("From").text());
                    $(".arrcity", tablinner).html(flight.find("To").text());
                    $(".deptime", tablinner).html(flight.find("STD").text().substr(11));
                    $(".arrtime", tablinner).html(flight.find("STA").text().substr(11));
                    $(".deptimeduration", tablinner).html(flight.find("TimeDuration").text());
                    $(".depflighttype", tablinner).html(flight.find("FlightTypes").text());
                    $(".planeName", tablinner).html(flight.find("FlightName").text());
                    $("#dvInnerContainer", tablesector).append(tablinner);

                    if(ftypes==1)
                    {
                        $(".ftype", tablinner).attr("src","../img/Red_img.png");
                        $(".wrapper .tooltip", tablinner).html(flight.find("FlightInfos").text());
                    }
                    else if(ftypes==2){
                        $(".ftype", tablinner).attr("src","../img/Orange_img.png");
                        $(".wrapper .tooltip", tablinner).html(flight.find("FlightInfos").text());
                    }
                    else if(ftypes==3){
                        $(".ftype", tablinner).attr("src","../img/Blue_img.png");
                        $(".wrapper .tooltip", tablinner).html(flight.find("FlightInfos").text());
                    }
                    tablinner = $("#dvInnerContainer  div", tablesector).eq(0).clone(true);
                });

                $("#dvMainRowContainer").append(tablesector);
                tablesector = $("#dvMainRowContainer div").eq(0).clone(true);
            }

            if(flights.length>0){
                hideshowFlightDiv('1');
                $('#dvMsg').hide();
            }
            else{
                hideshowFlightDiv('0');
                $('#dvMsg').html('Sorry : Flight not available.');
                $('#dvMsg').show();
            }
            $('html, body').animate({
                scrollTop: $("#dvMainRowContainer").offset().top
            }, 2000, 'easeOutExpo');
        }

        //Get Get Flight Info
        function GetFlightInfo()
        {
            $('.loader').show();
            var sodRequestList = new Array();
            if (travelRequestTypeIdG == "3")
            {
                //For Multicity
                var mlist = $("#dvInnerContainer input");
                mlist.each(function() {
                    if ($(this).is(':checked')) {
                        var mparents = $(this).parent().parent();
                        var mobj = new Object();
                        mobj.Sector = $(".depcity", mparents).html() + '-' + $(".arrcity", mparents).html();
                        mobj.TravelDate = $(".arrDate", mparents).html();
                        mobj.FlightNo = $(".depflightNo", mparents).html();
                        mobj.DepartureTime = $(".deptime", mparents).html();
                        mobj.ArrivalTime = $(".arrtime", mparents).html();
                        mobj.FlightName = $(".planeName", mparents).text();
                        mobj.FlightTypes =$(".depflighttype", mparents).text();  
                        sodRequestList.push(mobj);
                    }
                });
            }
            else
            {
                //For One Way and Round Trip
                var alist = $("#dvgo input");
                //for Arrival List
                alist.each(function() {
                    if ($(this).is(':checked')) {
                        var parents = $(this).parent().parent();
                        var obj = new Object();
                        obj.Sector = $(".depcity", parents).html() + '-' + $(".arrcity", parents).html();
                        obj.TravelDate = $(".arrDate", parents).html();
                        obj.FlightNo = $(".depflightNo", parents).html();
                        obj.DepartureTime = $(".deptime", parents).html();
                        obj.ArrivalTime = $(".arrtime", parents).html();
                        obj.FlightName = $(".planeName", parents).text();
                        obj.FlightTypes =$(".depflighttype", parents).text();  
                        sodRequestList.push(obj);
                    }
                });

                //for Return List
                var rlist = $("#dvreturn input");
                rlist.each(function() {
                    if ($(this).is(':checked')) {
                        var rparents = $(this).parent().parent();
                        var robj = new Object();
                        robj.Sector = $(".retCity", rparents).html() + '-' + $(".ret_arrcity", rparents).html();
                        robj.TravelDate = $(".ret_arrDate", rparents).html();
                        robj.FlightNo = $(".retFlightNo", rparents).html();
                        robj.DepartureTime = $(".rettime", rparents).html();
                        robj.ArrivalTime = $(".ret_arrtime", rparents).html();
                        robj.FlightName = $(".planeName", rparents).text();
                        robj.FlightTypes =$(".retflighttype", rparents).text();  
                        sodRequestList.push(robj);
                    }
                });
            }
            if (sodRequestList.length==0) {
                alert('Please select flight.');
                return false;
            }
            var sodRequestsList = JSON.stringify({ sodRequestsList: sodRequestList });
            $.ajax({
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                type: 'POST',
                url: '../EmployeeBookingDetail/SubmitFlightInfo',
                data: sodRequestsList,
                beforeSend: function(){
                    $('.loader').show()
                },
                complete: function(){
                    $('.loader').hide();
                },
                success: function (data) {
                    var url = '@Url.Action("EmpBookingDetail", "EmployeeBookingDetail")';
                    window.location.href = url;
                },
                error: function () {
                    $("#spanfail").html("Error on Save data.");
                }
            });
        }

    </script>

</head>
<body onload="hideshowFlightDiv('0');">
 <div>
    <div class="bookingheadr">
    <div class="container">

    <div class="row"> 
        <div class="col-md-6">
            <div class="usrdtlsdiaplay">
    <div class="row">
        <div class="col-md-12">
            <nav class="navbar navbar-default navbar-static-top navbar-transparent">
    <div class="container">
    <div class="row">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">          
            <button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="#" class="navbar-brand" id="logo"><img src="../img/logo_spicejet.png"/></a>
            <div class="nav navbar-header headertitle">  <div  class="sodHeading"> SOD BOOKING SYSTEM</div></div>
        </div>


        <!-- Collection of nav links and other content for toggling -->
        <div id="navbarCollapse" class="collapse navbar-collapse" style="background:#EE1D23; border:none; padding:3px;">
         <div class="dropdown" style="padding-bottom:5px;">@Session["UserInfo"]   </div>
         <a href="#" target="blank" id="lnktravelHistory">SOD Travel History</a>  | 
         <a href="#" target="blank" id="lnkbbklist">Bulk Booking History</a>  |
         @*<a href="#" target="blank" id="lnkoatHistory">OAT History</a>  |*@  
         <a href="#" target="blank" id="lnkapprover">SOD Approver List</a> |  
         <a href="#" target="blank" id="lnkbulkapprover">Bulk Approver List</a>  
         @*<a href="#" target="blank" id="lnkoatapprover">Oat Approver List</a>*@  
         <span class="logoutpic"><a href="../Login/UserAccount" ><img src="~/img/lgout.png" /></a></span> 
        </div>
       </div>
     </div>
    </nav>
    </div>
   </div>
   </div>
  </div>
  </div>
 </div>         
</div>

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="bookingtype">

                    <div class="col-md-2"><div class="bookingtypetxt">BOOKING TYPE :</div> </div>
                    <div class="col-md-3">
                        <table>
                            <tr>
                                <td style="padding-left:5px;"><input type="radio" style="height:17px; " name="radio" value="sod" checked="checked" id="rdoSod" onchange="Sod_NonSodChange();" /></td>
                                <td class="bookingtypetxt">SOD</td>
                                <td><input type="radio" name="radio" style="height:17px;" value="non-sod" id="rdoNonSod" onchange="Sod_NonSodChange();" /></td>
                                <td class="bookingtypetxt">NON-SOD</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-5">
                        <table class="bktype_mob_nd_left">
                            <tr id="trsodtype">
                                @*<td><input type="radio" name="radio" style="height:17px; padding-right:5px;" value="oalbooking" id="rdooalBooking" onchange="OALBookingChange();" /> </td>
    <td class="bookingtypetxt">OAT (Other Airlines Ticketing)</td>
    <td><input type="radio" name="radio" style="height:17px; padding-right:5px;" value="blkbooking" id="rdobulkBooking" onchange="BulkBookingChange();" /> </td>
    <td class="bookingtypetxt">Bulk Booking</td>*@
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-2">
                        <table>
                            <tr></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tabtopgap" >
            <div class="container">
                <div class="row">
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#menu1" onclick="hideshowFlightDiv('0');">ONE WAY</a></li>
                        <li><a data-toggle="tab" href="#menu2" onclick="hideshowFlightDiv('0');">ROUND TRIP</a></li>
                        <li><a data-toggle="tab" href="#menu3" onclick="hideshowFlightDiv('0');">MULTICITY</a></li>
                    </ul>
                    <div class="tab-content">
                        <div id="menu1" class="tab-pane fade in active">
                            <div style="margin-top:10px;">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div>
                                                <span class="asterisk_input2"></span>
                                                <input id="txt-pickup" type="text" value="" placeholder="Leaving from..." class="fh_inputtxt" />
                                            </div>
                                            <div class="conthdtxt">Origin</div>
                                        </div>

                                        <div class="col-md-3">
                                            <input id="txt-destination" type="text" value="" placeholder="Going to..." class="fh_inputtxt" />
                                            <div class="conthdtxt">Destination</div>
                                        </div>

                                        <div class="col-md-2">
                                            <div id="txtddateD">
                                                <i class="img_i" onclick="document.getElementById('txtddate').focus();"></i>
                                                <input id="txtddate" type="text" placeholder="Departure Date " class="fh_inputtxt2" />
                                            </div>
                                            <div class="conthdtxt">Date of Travel</div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="col-md-8" style="margin-left:-12px">
                                                <div id="txtadateD">
                                                    <i onclick="document.getElementById('txtadate').focus();"></i>
                                                    <div><select class="bookingtyp" id="ddlbookingFor"><option>Standby</option><option>Confirm</option></select></div>
                                                </div>
                                                <div class="conthdtxt">Booking for</div>
                                            </div>
                                            <div class="col-md-4">
                                                <div id="txtadateD">
                                                    <i onclick="document.getElementById('ddpassenger').focus();"></i>
                                                    <div><select class="bookingtyp" style="width:40px;" id="ddpassenger">
                                                        <option>1</option><option>2</option>
                                                        <option>3</option><option>4</option>
                                                        <option>5</option><option>6</option>
                                                        <option>7</option><option>8</option><option>9</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="conthdtxt">Passengers</div>
                                            </div>                                         
                                        </div>
                                        <div class="col-md-1">
                                           <div class="three_D2"> <input class="searchbt" type="button" value="Search" id="OnewaySubmit" onclick="OnewaySubmit();" /></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> <!--/ Container  End -->

                        <div id="menu2" class="tab-pane fade">
                            <div style="margin-top:10px;">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <div>
                                                <span class="asterisk_input2"></span>
                                                <input id="txt-pickup-rt" type="text" value="" placeholder="Leaving from..." class="fh_inputtxt" />
                                            </div>
                                            <div class="conthdtxt">Origin</div>
                                        </div>
                                        <div class="col-md-2">
                                            <input id="txt-destination-rt" type="text" value="" placeholder="Going to..." class="fh_inputtxt" />
                                            <div class="conthdtxt">Destination</div>
                                        </div>

                                        <div class="col-md-2">
                                            <div id="Div1">
                                                <i class="img_i" onclick="document.getElementById('rarrivaldt').focus();"></i><input id="rarrivaldt" type="text" placeholder="Departure Date" class="fh_inputtxt2" />
                                            </div>
                                            <div class="conthdtxt">Date of Travel</div>
                                        </div>
                                        <div class="col-md-2">
                                            <div id="Div3">
                                                <i class="img_i" onclick="document.getElementById('rdepartdt').focus();"></i><input id="rdepartdt" type="text" placeholder="Arrival Date" class="fh_inputtxt2" />
                                            </div>
                                            <div class="conthdtxt">Return Date</div>
                                        </div>
                                        <div class="col-md-2">
                                                <div class="col-md-8" style="margin-left:-12px">
                                                    <div id="txtadateD">
                                                        <i onclick="document.getElementById('txtadate').focus();"></i>
                                                        <div><select class="bookingtyp" id="ddlbookingFor_roundtrip"><option>Standby</option><option>Confirm</option></select></div>
                                                    </div>
                                                    <div class="conthdtxt">Booking for</div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div id="txtadateD">
                                                        <i onclick="document.getElementById('txtadate').focus();"></i>
                                                        <div>
                                                            <select class="bookingtyp" style="width:40px;" id="ddpassenger_roundtrip">
                                                                <option>1</option>
                                                                <option>2</option>
                                                                <option>3</option>
                                                                <option>4</option>
                                                                <option>5</option>
                                                                <option>6</option>
                                                                <option>7</option>
                                                                <option>8</option>
                                                                <option>9</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="conthdtxt">Passengers</div>
                                                </div>
                                          </div>

                                        <div class="col-md-2">
                                          <div class="three_D2">  <input id="btnRoundTrip" class="searchbt" type="button" value="Search" onclick="RoundTripSubmit();" /></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="menu3" class="tab-pane fade">
                            <div id="TextBoxesGroup">
                                <div style="margin-top:10px; border:solid 1px #b33; border-radius:3px; padding:5px;" >
                                    <table class="dynamiccontroltbl" style="width:100%">
                                        <tr>
                                            <td>
                                                <p style="font-size:16px; color:#b33;">City #1</p>
                                                <div class="container">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <div>
                                                                <span class="asterisk_input2"></span>
                                                                <input id="textboxorigin1" type="text" value="" placeholder="Leaving from..." class="fh_inputtxt" />
                                                            </div>
                                                            <div class="conthdtxt">Origin</div>
                                                        </div>

                                                        <div class="col-md-3">
                                                            <input id="textboxdest1" type="text" value="" placeholder="Going to..." class="fh_inputtxt" />
                                                            <div class="conthdtxt">Destination</div>
                                                        </div>

                                                        <div class="col-md-3">
                                                            <div id="Div4">
                                                                <i onclick="document.getElementById('txtddate').focus();"></i><input id="txttraveldt1" type="text" placeholder="Departure Date " class="fh_inputtxt2" />
                                                            </div>
                                                            <div class="conthdtxt">Date of Travel</div>
                                                        </div>

                                                        <div class="col-md-2">
                                                            <div class="col-md-8" style="margin-left:-12px">
                                                                <div id="txtadateD">
                                                                    <i onclick="document.getElementById('txtadate').focus();"></i>
                                                                    <div><select class="bookingtyp" id="ddlbookingFor_multicity"><option>Standby</option><option>Confirm</option></select></div>
                                                                </div>
                                                                <div class="conthdtxt">Booking for</div>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <div id="txtadateD">
                                                                    <i onclick="document.getElementById('txtadate').focus();"></i>
                                                                    <div>
                                                                        <select class="bookingtyp" style="width:40px;" id="ddpassenger_multicity">
                                                                            <option>1</option>
                                                                            <option>2</option>
                                                                            <option>3</option>
                                                                            <option>4</option>
                                                                            <option>5</option>
                                                                            <option>6</option>
                                                                            <option>7</option>
                                                                            <option>8</option>
                                                                            <option>9</option>
                                                                        </select>
                                                                    </div>
                                                                 </div>
                                                                <div class="conthdtxt">Passengers</div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-1"></div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="row">
                                        <div class="col-md-2"><span class="three_D2_gray"><input id="addButtonnew"  type="button" value="Add Flight +" /></span> </div> <div class="col-md-2"> <span class="three_D2_gray"> <input type='button' value='Remove Flight -' id='removeButton' ></span></div>
                                        <div class="col-md-8"> <div style="margin-top:20px;" class="three_D2">
                                        <input type='button' class="searchbt" value='Submit' id='btnMulCity' onclick="MulticitySubmit();"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div id="dvMainRowContainer" title="">
                    <div class="row">
                        <div class="col-md-12">
                            <div style="width:100%; border:solid 1px #b33; margin-top:30px; margin-bottom:20px; padding:10px;" id="dvInnerContainer">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div id="dvgo">
                                            <div class="row" style="padding-bottom:35px; ">
                                                <div class="col-md-1"><input type="radio" id="chkradiodept" name="chkradiodept" /></div>
                                                <div class="col-md-11">
                                                    <table style="width:100%;">
                                                        <tr><td class="planeimg"><img src="../img/plane.png"/> <input type="hidden" class="planeName"></td><td><span class="deptime">6:50 AM</span></td><td><img src="../img/arrow_icon.png" style=" text-align:left;" /></td> <td><span class="arrtime">6:50 AM</span></td></tr>
                                                        <tr><td><span style="padding-left:10px;" class="depflightNo">SG160</span> <input type="hidden" class="depflighttype" /> </td><td><span class="depcity">Delhi</span></td><td><div class="wrapper"><img class="ftype" /><div class="tooltip"></div></div></td><td><span class="arrcity">Mumbai</span></td></tr>
                                                        <tr><td></td><td>Total Duration:<span class="deptimeduration">2h 10m</span></td><td></td><td><span class="arrDate">  Thu 25, Feb 2016</span></td></tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                   
                                    <div class="col-md-6">
                                        <div id="dvreturn">
                                            <div class="dvretbrdr">
                                                <div class="row">
                                                    <div class="col-md-1"><input type="radio" name="chkradioreturn" /></div>
                                                    <div class="col-md-11">
                                                        <table style="width:100%;margin-left:-30px;">
                                                            <tr><td class="planeimg"><img src="../img/plane_return.png"/> <input type="hidden" class="planeName"></td><td><span class="rettime">6:50 AM</span></td><td><img src="../img/arrow_icon.png" style=" text-align:left;" /></td><td><span class="ret_arrtime">6:50 AM</span></td></tr>
                                                            <tr><td><span style="padding-left:10px;" class="retFlightNo">SG160</span> <input type="hidden" class="retflighttype" /></td><td><span class="retCity">Mumbai</span></td><td><div class="wrapper"><img class="ftype" /><div class="tooltip"></div></div></td><td><span class="ret_arrcity">Delhi</span></td></tr>
                                                            <tr><td></td><td>Total Duration:<span class="retDuration"> 2h 10m</span> </td><td></td><td><span class="ret_arrDate">  Thu 25, feb 2016</span></td></tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="dvMsg" style="font-size:14px;"></div>
                 <div class="row">
                    <div class="col-md-12">
                        <div style="margin-top:10px; margin-bottom:10px; text-align:left" id="imgFlyteType"> 
                            <span><img src="../img/Red_img.png"> -Direct    &nbsp; </span>
                            <span><img src="../img/Orange_img.png"> -Hopping(Same Aircraft)     &nbsp;</span>
                            <span><img src="../img/Blue_img.png"> -Hopping(Change of Aircraft)   </span>
                        </div>
                        <div style="margin-top:20px; margin-bottom:20px; text-align:center">
                                <div class="three_D3">
                                    <a href="#" id="lnkContinue" onclick="return GetFlightInfo();"> Continue >></a>&nbsp;
                                    <a href="#" id="lnkRefresh" onclick="location.reload();"> Refresh</a>
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
    <div style="padding-top:100px;"></div>
    <footer class="essfooter">
            <div class="container">
            </div>
        </footer>
    </div>

 <div class="loader">
        <center>
            <img class="loading-image" src="../images/loading.gif" alt="loading..">
        </center>
     </div>

    @if (ViewBag.Message != null)
    {
        <script type="text/javascript">
            window.onload = function () {
                alert("@ViewBag.Message");
                var win = window.open("about:blank", "_self"); 
                win.close();
            };
        </script>
    } 

</body>
</html>

